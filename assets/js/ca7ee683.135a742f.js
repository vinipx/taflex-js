"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[3037],{6172(e,t,n){n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"tutorials/contract-testing","title":"Contract Testing Tutorial","description":"This tutorial will walk you through creating your first Consumer-Driven Contract test using Pact in taflex-js.","source":"@site/docs/tutorials/contract-testing.md","sourceDirName":"tutorials","slug":"/tutorials/contract-testing","permalink":"/taflex-js/docs/tutorials/contract-testing","draft":false,"unlisted":false,"editUrl":"https://github.com/vinipx/taflex-js/tree/main/docs/docs/tutorials/contract-testing.md","tags":[],"version":"current","lastUpdatedAt":1771082300000,"frontMatter":{},"sidebar":"docs","previous":{"title":"Mobile Testing Tutorial","permalink":"/taflex-js/docs/tutorials/mobile-tests"},"next":{"title":"Testing in the Cloud","permalink":"/taflex-js/docs/tutorials/cloud-execution"}}');var s=n(4848),i=n(8453);const a={},c="Contract Testing Tutorial",o={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step 1: Create the Consumer Test",id:"step-1-create-the-consumer-test",level:2},{value:"Step 2: Run the Test and Generate the Pact",id:"step-2-run-the-test-and-generate-the-pact",level:2},{value:"Step 3: Provider Verification (Conceptual)",id:"step-3-provider-verification-conceptual",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const t={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"contract-testing-tutorial",children:"Contract Testing Tutorial"})}),"\n",(0,s.jsxs)(t.p,{children:["This tutorial will walk you through creating your first Consumer-Driven Contract test using Pact in ",(0,s.jsx)(t.strong,{children:"taflex-js"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["We will simulate a scenario where a ",(0,s.jsx)(t.strong,{children:"User Web App"})," (Consumer) expects a specific response from a ",(0,s.jsx)(t.strong,{children:"User Profile Service"})," (Provider)."]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Ensure you have run ",(0,s.jsx)(t.code,{children:"./setup.sh"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["Enable Pact in your ",(0,s.jsx)(t.code,{children:".env"}),":","\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-env",children:"PACT_ENABLED=true\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"step-1-create-the-consumer-test",children:"Step 1: Create the Consumer Test"}),"\n",(0,s.jsxs)(t.p,{children:['The Consumer defines the "Contract". We want to ensure that when we call ',(0,s.jsx)(t.code,{children:"GET /users/profile"}),", we receive a JSON with ",(0,s.jsx)(t.code,{children:"username"})," and ",(0,s.jsx)(t.code,{children:"role"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["Create ",(0,s.jsx)(t.code,{children:"tests/contract/consumer/profile.spec.js"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"import { describe, it, expect } from 'vitest';\nimport { pactManager } from '../../../src/core/contracts/pact.manager.js';\nimport axios from 'axios';\n\ndescribe('User Profile Contract', () => {\n  // Initialize the Pact Mock Server\n  const pact = pactManager.setup('user-web-app', 'profile-service');\n\n  it('validates the response for a valid user', async () => {\n    // 1. Define the expectation (The Interaction)\n    await pactManager.addInteraction({\n      state: 'user exists',\n      uponReceiving: 'a request for user profile',\n      withRequest: {\n        method: 'GET',\n        path: '/profile',\n      },\n      willRespondWith: {\n        status: 200,\n        headers: { 'Content-Type': 'application/json' },\n        body: {\n          username: 'johndoe',\n          role: 'editor'\n        },\n      },\n    });\n\n    // 2. Execute the test against the mock server\n    await pactManager.executeTest(async (mockServer) => {\n      const response = await axios.get(`${mockServer.url}/profile`);\n      \n      // Verify that the consumer code (axios in this case) \n      // can handle the expected response\n      expect(response.status).toBe(200);\n      expect(response.data.username).toBe('johndoe');\n    });\n  });\n});\n"})}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"step-2-run-the-test-and-generate-the-pact",children:"Step 2: Run the Test and Generate the Pact"}),"\n",(0,s.jsx)(t.p,{children:"Execute the contract test suite:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"npm run test:contract\n"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"What happened?"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"A mock server was started."}),"\n",(0,s.jsx)(t.li,{children:"The test made a real HTTP call to that mock server."}),"\n",(0,s.jsx)(t.li,{children:"Pact verified that the call matched the interaction we defined."}),"\n",(0,s.jsxs)(t.li,{children:["A JSON file was created in the ",(0,s.jsx)(t.code,{children:"/pacts"})," directory. This is your ",(0,s.jsx)(t.strong,{children:"Contract"}),"."]}),"\n"]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"step-3-provider-verification-conceptual",children:"Step 3: Provider Verification (Conceptual)"}),"\n",(0,s.jsxs)(t.p,{children:["Now that you have the JSON contract, the ",(0,s.jsx)(t.strong,{children:"Provider"})," team (API developers) must verify that their real service follows it."]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Start your local API service (e.g., on ",(0,s.jsx)(t.code,{children:"http://localhost:3000"}),")."]}),"\n",(0,s.jsxs)(t.li,{children:["Run the verification command:","\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"npm run pact:verify\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Tip"}),": In a real CI/CD pipeline, you would publish the JSON file to a ",(0,s.jsx)(t.strong,{children:"Pact Broker"})," (like PactFlow) and have the Provider pipeline fetch it automatically."]}),"\n"]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(t.p,{children:"You have successfully:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Defined a contract as a Consumer."}),"\n",(0,s.jsx)(t.li,{children:"Verified the contract against a Mock Server."}),"\n",(0,s.jsx)(t.li,{children:"Generated a portable JSON Pact file."}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["For more advanced configurations and Pact Broker integration, check the ",(0,s.jsx)(t.a,{href:"../guides/pact-testing",children:"Pact Testing Guide"}),"."]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453(e,t,n){n.d(t,{R:()=>a,x:()=>c});var r=n(6540);const s={},i=r.createContext(s);function a(e){const t=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);